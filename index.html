<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recycling Plant Locator</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f4f4; }
        #map { width: 100%; height: 400px; border-radius: 10px; margin-top: 20px; }
        .result-card { margin-top: 20px; padding: 15px; border-radius: 10px; background-color: white; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center mb-4">Recycling Plant Locator</h2>
        <div class="input-group mb-3">
            <input type="text" id="zipCode" class="form-control" placeholder="Enter ZIP code">
            <button class="btn btn-success" onclick="findRecyclingPlants()">Search</button>
        </div>

        <div id="results"></div>
        <div id="map"></div>
    </div>

    <script>
        let map;

        function findRecyclingPlants() {
            let zip = document.getElementById("zipCode").value;
            if (!zip) {
                alert("Please enter a ZIP code.");
                return;
            }

            fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zip}&format=json`)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        alert("Invalid ZIP code. Try again.");
                        return;
                    }
                    let userLat = parseFloat(data[0].lat);
                    let userLon = parseFloat(data[0].lon);
                    searchRecyclingCenters(userLat, userLon);
                })
                .catch(error => console.error("Error fetching location:", error));
        }

        function searchRecyclingCenters(lat, lon) {
            // Initialize Leaflet map
            map = L.map('map').setView([lat, lon], 12);

            // Use OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Add marker for user's location
            L.marker([lat, lon]).addTo(map)
                .bindPopup("Your Location")
                .openPopup();

            // Simulate recycling centers for example purposes
            let recyclingCenters = [
                { name: "Green Earth Recycling", lat: lat + 0.02, lon: lon + 0.05, address: "123 Eco St, New York" },
                { name: "EcoCycle Center", lat: lat - 0.03, lon: lon - 0.07, address: "456 Green Rd, Los Angeles" },
                { name: "Sustainable Waste Solutions", lat: lat + 0.05, lon: lon - 0.04, address: "789 Recycle Ave, Chicago" }
            ];

            // Display recycling centers and add markers
            displayResults(recyclingCenters, lat, lon);
        }

        function displayResults(centers, userLat, userLon) {
            let resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";

            centers.forEach((center, index) => {
                let lat = center.lat;
                let lon = center.lon;
                let name = center.name;
                let address = center.address;

                // Create a result card for each recycling center
                let resultCard = document.createElement("div");
                resultCard.className = "result-card";
                resultCard.innerHTML = `
                    <h4>${index + 1}. ${name}</h4>
                    <p><strong>Address:</strong> ${address}</p>
                    <p><strong>Distance:</strong> ~${calculateDistance(userLat, userLon, lat, lon).toFixed(2)} km</p>
                `;
                resultsDiv.appendChild(resultCard);

                // Add marker for each recycling center
                L.marker([lat, lon]).addTo(map)
                    .bindPopup(`<strong>${name}</strong><br>${address}`)
                    .openPopup();
            });
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of Earth in km
            const dLat = (lat2 - lat1) * (Math.PI / 180);
            const dLon = (lon2 - lon1) * (Math.PI / 180);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }
    </script>
</body>
</html>
